#!/usr/bin/env bash

set -e

script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
package_dir="$(cd "$script_dir/.." && pwd)"
project_dir="$(pwd)"

mkdir -p "$project_dir/docker"
cp -R "$package_dir/runtimes/"* "$project_dir/docker"
cp "$package_dir/.env.example" "$project_dir/.env"
cp "$package_dir/dock" "$project_dir/dock"
cp "$package_dir/docker-compose.yml" "$project_dir/docker-compose.yml"
cp "$package_dir/test.sh" "$project_dir/test.sh"

gitignore_file="$project_dir/.gitignore"
if [ ! -f "$gitignore_file" ]; then
    touch "$gitignore_file"
fi

{
    grep -qxF '.vendor/' "$gitignore_file" || echo -e '\n.vendor/' >> "$gitignore_file"
    grep -qxF '.env' "$gitignore_file" || echo '.env' >> "$gitignore_file"
}